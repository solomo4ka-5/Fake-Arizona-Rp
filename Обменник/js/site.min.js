$(document).ready(function(){new Vue({el:"#vue",data:{buttonLock:!1,errors:{},currencies:[],directions:[],currentDirections:[],direction:{from:{fullname:"\u041d\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043e"},to:{fullname:"\u041d\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043e"}},order:{},tempOrder:{from_id:"",from_amount:"",from_requisites:"",to_id:"",to_amount:"",to_requisites:"",partner_id:"",email:"",uid:""},partner:{buttonLock:!1,errors:{},captchaUrl:"",
tempSignup:{email:"",password:"",password_confirmation:""}}},methods:{handleSuccess:function(a){UIkit.notify(a.data,{pos:"top-left",status:"primary"})},handleError:function(a,b){"string"===typeof a.data?UIkit.notify(a.data,{pos:"top-left",status:"danger",timeout:0}):""!=b?this[b].errors=a.data:this.errors=a.data},currenciesRead:function(){var a=this;return this.$http.get("/api/currencies").then(function(b){a.currencies=b.data})},currenciesSelect:function(a){this.tempOrder.from_amount="";this.tempOrder.from_requisites=
"";this.tempOrder.to_amount="";this.tempOrder.to_requisites="";this.directionsFilterCurrent(a);this.directionsApply(this.currentDirections[0])},directionsRead:function(){var a=this;return this.$http.get("/api/directions").then(function(b){a.directions=b.data})},directionsFilterCurrent:function(a){this.currentDirections=this.directions.filter(function(b){return b.from.id==a})},directionsFind:function(a){return this.directions.find(function(b){return b.id==a})||null},directionsApply:function(a){this.direction.id!=
a.id&&(this.tempOrder.from_amount="",this.tempOrder.from_requisites="",this.tempOrder.to_amount="",this.tempOrder.to_requisites="");this.direction=a;this.tempOrder.from_id=a.from.id;this.tempOrder.to_id=a.to.id},orderCreate:function(){var a=this;this.buttonLock=!0;this.errors={};var b=this.tempOrder;b.uid=uid;this.$http.post("/api/order/"+this.direction.id+"/create",b).then(function(a){window.location.replace("/"+a.data.id+"/"+a.data.secret)},function(b){a.handleError(b,"")}).then(function(b){a.buttonLock=
!1})},orderCancel:function(){var a=this;UIkit.modal.confirm("\u0425\u043e\u0442\u0438\u0442\u0435 \u043e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443?",function(){a.$http["delete"]("/api/order/"+globals.order_id+"/"+globals.order_secret).then(function(a){window.location.replace("/")})},{labels:{Cancel:"\u041d\u0435\u0442",Ok:"\u0414\u0430, \u043e\u0442\u043c\u0435\u043d\u044f\u044e"}})},orderRead:function(){var a=this;return this.$http.get("/api/order/"+globals.order_id+
"/"+globals.order_secret).then(function(b){a.order=b.data})},rulesShow:function(){UIkit.modal("#rules-show-modal").show()},partnershipShow:function(){this.partnerCaptcha();this.partner.errors={};this.partner.tempSignup={email:"",password:"",password_confirmation:""};UIkit.modal("#partnership-show-modal").show()},apiShow:function(){UIkit.modal("#api-show-modal").show()},trustShow:function(){UIkit.modal("#trust-show-modal").show()},orderShow:function(){this.orderRead().then(function(){UIkit.modal("#order-show-modal",
{bgclose:!1}).show()})},partnerCaptcha:function(){this.partner.captchaUrl="/captcha?"+(8999*Math.random()+1E3)},partnerSignup:function(){var a=this;this.partner.buttonLock=!0;this.$http.post("/partner/signup",this.partner.tempSignup).then(function(b){a.handleSuccess(b);UIkit.modal("#partnership").hide()},function(b){a.handleError(b,"partner");a.partnerCaptcha()}).then(function(b){a.partner.buttonLock=!1})}},mounted:function(){var a=this;UIkit.modal("#block-modal").show();this.tempOrder.partner_id=
globals.partner_id;this.currenciesRead().then(function(){a.directionsRead().then(function(){if(direction=a.directionsFind(globals.direction_id))a.directionsApply(direction),a.directionsFilterCurrent(direction.from.id);var b=function(a){a.val(a.val().replace(/,/,".").replace(/[^\.^\d]/,""));0>+a.val()&&a.val(0)};$("form input[name='from_amount']").keyup(function(){b($(this));if(1==a.direction.type)a.tempOrder.to_amount=a.tempOrder.from_amount*a.direction.current_course,a.tempOrder.to_amount=a.tempOrder.to_amount.toFixed(a.direction.to.precision);
else if(1==a.direction.comission_type)a.tempOrder.to_amount=a.tempOrder.from_amount/a.direction.current_course-a.direction.comission,a.tempOrder.to_amount=a.tempOrder.to_amount.toFixed(a.direction.to.precision);else if(2==a.direction.comission_type){var c=a.tempOrder.from_amount/100*a.direction.comission_percent;c=c.toFixed(a.direction.from.precision);a.tempOrder.to_amount=(a.tempOrder.from_amount-(c>a.direction.comission_min?c:a.direction.comission_min))/a.direction.current_course;a.tempOrder.to_amount=
a.tempOrder.to_amount.toFixed(a.direction.to.precision)}});$("form input[name='to_amount']").keyup(function(){b($(this));if(1==a.direction.type)a.tempOrder.from_amount=a.tempOrder.to_amount/a.direction.current_course;else if(1==a.direction.comission_type)a.tempOrder.from_amount=(1*a.tempOrder.to_amount+a.direction.comission)*a.direction.current_course,a.tempOrder.from_amount=a.tempOrder.from_amount.toFixed(a.direction.from.precision);else if(2==a.direction.comission_type){a.tempOrder.from_amount=
a.tempOrder.to_amount*a.direction.current_course;a.tempOrder.from_amount=a.tempOrder.from_amount.toFixed(a.direction.from.precision);var c=a.tempOrder.from_amount/(100-a.direction.comission_percent)*a.direction.comission_percent;c=c.toFixed(a.direction.from.precision);a.tempOrder.from_amount=1*a.tempOrder.from_amount+1*(c>a.direction.comission_min?c:a.direction.comission_min);a.tempOrder.from_amount=a.tempOrder.from_amount.toFixed(a.direction.from.precision)}});UIkit.modal("#block-modal").hide();
globals.order_id&&globals.order_secret&&(a.orderShow(),setInterval(function(){a.orderRead()},5E3))})})}})});